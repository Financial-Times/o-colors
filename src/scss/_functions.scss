@function _oColorsGetPaletteColor($name) {
  @each $color in $o-colors-palette-list {
    @if nth($color,1) == $name {
      @return nth($color,2);
    }
  }
  @warn "Undefined color '" + $name + "' used";
  @return black;
}

@function _oColorsGetUseCase($name, $property) {
  $warning: null;
  $provisionalColor: null;
  @each $usecase in $o-colors-usecase-list {
    @if ( ($property != all and $name == nth($usecase, 1) and $property == nth($usecase, 3))
        or (nth($usecase, 3) == all and $name == nth($usecase, 1)) ) {

      @if (length($usecase) == 4 and nth($usecase,4) == DEPRECATED) {
        $warning: "Deprecated use-case name '" + $name + "', property '" + $property + "' used";
        $provisionalColor: _oColorsGetPaletteColor(nth($usecase,2));
      } @else {
        @return (color: _oColorsGetPaletteColor(nth($usecase,2)));    
      }
    }
  }
  @if ($provisionalColor) {
    @return (color: $provisionalColor, warning: $warning);    
  }
  @return undefined;
}


@function oColorsGetColorFor($namelist, $property: "") {
  $color: undefined;
  $candidateColor: undefined;
  @each $name in $namelist {
    @if ($color == undefined or map-has-key($color, warning)) {
      @if ($property == "") {
        $candidateColor: _oColorsGetUseCase($name, all);
      } @else {
        $candidateColor: _oColorsGetUseCase($name, $property);        
      }

      @if ($color == undefined) {
        $color: $candidateColor;
      } @else if (map-has-key($color, warning)) {
        @if ( $candidateColor != undefined and not map-has-key($candidateColor, warning)) {
          $color: $candidateColor;
        }
      }
    }
  }
  @if ($color == undefined) {
    $error: "Undefined use-case: can\'t resolve '" + $namelist + "' to a colour";
    @if ($property) {
      $error: $error + " for property '" + $property;
    }
    @warn $error;
    $color: (color: black);
  } @else if (map-has-key($color, warning)) {
    @warn map-get($color, warning);
  }
  @return map-get($color, color);
}
